{"version":3,"sources":["goods_list.js"],"names":["$","QueryObj","query","cid","getUrl","pagenum","pagesize","TotalPage","init","eventList","mui","pullRefresh","container","down","auto","callback","cb","data","html","template","arr","endPulldownToRefresh","refresh","goodsSearch","up","console","log","endPullupToRefresh","append","func","get","result","meta","status","goods","Math","ceil","total","on","href","location","name","reg","RegExp","r","window","search","substr","match","decodeURI"],"mappings":"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","sourcesContent":["$(function(){\r\n    let QueryObj ={\r\n        query:\"\",\r\n        cid:getUrl('cid'),\r\n        pagenum:1,\r\n        pagesize:10\r\n\r\n    }\r\n\r\n    let TotalPage = 1;\r\n\r\n  init();\r\n  function init() {\r\n\r\n    eventList()\r\n    // 开始调用mui的下拉组件\r\n    mui.init({\r\n      pullRefresh: {\r\n        container: \".pyg_view\",\r\n        // 下拉刷新组件的配置\r\n        down: {\r\n          // 一打开页面的时候 自动显示 下拉刷新组件\r\n          auto: true,\r\n          //  触发下拉刷新时自动触发\r\n          callback: function() {\r\n            // 一旦看到下拉刷新组件 就表示 该代码也会一起被执行\r\n            let cb = function(data) {\r\n              let html = template(\"mainTpl\", { arr: data });\r\n              $(\".list\").html(html);\r\n\r\n              // 结束下拉刷新\r\n              mui(\".pyg_view\")\r\n                .pullRefresh()\r\n                .endPulldownToRefresh();\r\n\r\n                // 重置 上拉组件\r\n                mui('.pyg_view').pullRefresh().refresh(true);\r\n            };\r\n\r\n            // 重置页码 变成第一页\r\n            QueryObj.pagenum=1;\r\n          \r\n            goodsSearch(cb);\r\n          }\r\n        },\r\n        // 上拉加载下一页的配置\r\n        up: {\r\n          //  触发上拉刷新时自动触发\r\n          callback: function() {\r\n            // 判断有没有下一页的数据\r\n            if (QueryObj.pagenum >= TotalPage) {\r\n              console.log(\"没有数据 不要再划了 网页都要崩掉！\");\r\n\r\n              mui(\".pyg_view\")\r\n              .pullRefresh()\r\n              .endPullupToRefresh(true);\r\n            } else {\r\n              console.log(\"还有数据 准备 下一次的请求\");\r\n              QueryObj.pagenum++;\r\n\r\n              // 定义数据回来之后的逻辑\r\n              let cb = function(data) {\r\n                let html = template(\"mainTpl\", { arr: data });\r\n                // append 追加\r\n                $(\".list\").append(html);\r\n\r\n             \r\n                mui(\".pyg_view\")\r\n                  .pullRefresh()\r\n                  .endPullupToRefresh(false);\r\n              };\r\n\r\n              goodsSearch(cb);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  // 获取商品列表数据\r\n  function goodsSearch(func) {\r\n    // $.get(\"地址\",\"？参数对象\",成功的回调函数)\r\n    $.get(\r\n      \"http://api.pyg.ak48.xyz/api/public/v1/goods/search\",\r\n      QueryObj,\r\n      function(result) {\r\n        // 判断请求成功\r\n        if (result.meta.status == 200) {\r\n          // 成功\r\n          // 模板要渲染的数据\r\n          let data = result.data.goods;\r\n\r\n          // 计算总页码\r\n          TotalPage = Math.ceil(result.data.total / QueryObj.pagesize);\r\n          console.log(TotalPage);\r\n\r\n          func(data);\r\n        } else {\r\n          console.log(\"失败\", result);\r\n        }\r\n      }\r\n\r\n\r\n    );\r\n  }\r\n\r\n  function eventList(){\r\n    $('.list').on('tap',\"a\",function(){\r\n      let href = this.href;\r\n      location.href=href\r\n    })\r\n  }\r\n    \r\n\r\n\r\n    // 获取url上的参数 的值\r\n  function getUrl(name) {\r\n    var reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\", \"i\");\r\n    var r = window.location.search.substr(1).match(reg);\r\n    if (r != null) return decodeURI(r[2]);\r\n    return null;\r\n  }\r\n})"],"file":"goods_list.js"}